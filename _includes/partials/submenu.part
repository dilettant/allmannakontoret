<nav>
  <ul class="primary">
    {% assign current = page.category%}
    {% capture current_menu %}{{current |Â prepend:'menu_'}}{% endcapture %}

    {% for cat in site[current_menu] %}

      {% for sec in cat %}
        {% assign sections = sec[forloop.index] %}
        {% assign item = sec[0]%}
        {% assign len = item.size %}

        {% if len %}

          <li{% if page.ref == item} %} class="active"{% endif %}><a href="{{site.baseurl}}/{{current}}/{{item}}.html#top">{% if site[item] %}{{site[item]}}{% else %}{{item}}{% endif %}</a></li>

          {% assign nsec = sections | size %}
          
          {% if nsec != 0%}
          {% capture curr %}{{ page.title | replace: ' ','_' }}{% endcapture %}


            <ul class="secondary{% if page.ref == item %} active{% elsif page.parent == item %} active{% endif %}">
            {% for i in nsec %}
          
              {% assign item = sections[forloop.index0]] %}
              <li{% if page.ref == item | replace:'_',' ' %} class="active"{% endif %}><a href="{{site.baseurl}}/{{current}}/{{item}}.html#top">{% if site[item] %}{{site[item]}}{% else %}{{item}}{% endif %}</a></li>
          
            {% endfor %}
            </ul>
          {% endif %}
        {% else %}
          {% assign item = cat%}
          <li{% if page.ref == item | replace:'_',' '} %} class="active"{% endif %}><a href="{{site.baseurl}}/{{current}}/{{item}}.html#top">{% if site[item] %}{{site[item]}}{% else %}{{item}}{% endif %}</a></li>
        {% endif %}

      {% endfor %}

    {% endfor %}
  </ul>
</nav>